(()=>{"use strict";console.log("app started");const t=new class{constructor(){this.url="https://ahj-helpdesk-http.herokuapp.com",this.getAllTickets="?method=allTickets",this.getId="?method=ticketById&id=",this.getIdDelete="?method=deleteId&id=",this.getStatusId="?method=statusId&id=",this.postCreate="?method=createTicket"}async save(t){const e=await fetch(`${this.url}${this.postCreate}`,{method:"POST",body:JSON.stringify(t)}),s=await e.text();console.log(`Server response: ${s}`)}async load(){try{const t=await fetch(`${this.url}${this.getAllTickets}`);return await t.json()}catch(t){return new Error(t)}}async loadId(t){try{const e=await fetch(`${this.url}${this.getId}${t}`);return await e.text()}catch(t){return new Error(t)}}async deleteId(t){try{const e=await fetch(`${this.url}${this.getIdDelete}${t}`);return await e.text()}catch(t){return new Error(t)}}async editStatusId(t){try{const e=await fetch(`${this.url}${this.getStatusId}${t}`);return await e.text()}catch(t){return new Error(t)}}},e=new class{constructor(t){this.memory=t,this.container=document.querySelector("#container"),this.addTicketBtn=document.querySelector(".add-ticket"),this.popup=document.querySelector("#pop-up"),this.popupDelete=document.querySelector("#pop-up-delete"),this.titlePopup=document.querySelector(".title-popup"),this.btnCancel=document.querySelector(".btn-cancel"),this.btnOk=document.querySelector(".btn-ok"),this.inputShortText=document.querySelector(".input-short-text"),this.inputLongText=document.querySelector(".input-long-text"),this.btnDelOk=document.querySelector(".btn-delete-ok"),this.btnDelCancel=document.querySelector(".btn-delete-cancel"),this.delOrEditMain=null,this.shortText=null,this.longText=null,this.date=null,this.done=!1}events(){this.renderTickets(),this.addTicketClick(),this.addTicketCancel(),this.addTicketOk(),this.inputShortTicket(),this.inputLongTicket(),this.statusDone(),this.deleteTicket(),this.deleteTicketCancel(),this.deleteTicketOk(),this.editTicket(),this.shortTextClick()}async renderTickets(){const t=await this.memory.load();for(const e of t)this.updateRender(e.name,e.created,e.status,e.id)}clearDom(){for(const t of this.container.querySelectorAll(".block"))t.remove()}addTicketClick(){this.addTicketBtn.addEventListener("click",(()=>{this.popup.classList.contains("none")&&(this.titlePopup.textContent="Добавить тикет",this.popup.classList.remove("none"))}))}addTicketCancel(){this.btnCancel.addEventListener("click",(()=>{this.popup.classList.contains("none")||(this.popup.classList.add("none"),this.inputShortText.value=null,this.inputLongText.value=null,this.shortText=null,this.longText=null)}))}addTicketOk(){this.btnOk.addEventListener("click",(()=>{if(this.popup.classList.contains("none")||"Добавить тикет"!==this.titlePopup.textContent||(this.popup.classList.add("none"),this.ticketDate(),this.newAddTicket(this.shortText,this.longText,this.date,this.done),this.inputShortText.value=null,this.inputLongText.value=null,this.shortText=null,this.longText=null,this.date=null),!this.popup.classList.contains("none")&&"Изменить тикет"===this.titlePopup.textContent){this.popup.classList.add("none"),this.delOrEditMain.children[0].children[0].classList.contains("done")&&(this.done=!0);const{id:t}=this.delOrEditMain.dataset;this.shortText=this.inputShortText.value,this.longText=this.inputLongText.value,this.newAddTicket(this.shortText,this.longText,this.date,this.done,t),this.inputShortText.value=null,this.inputLongText.value=null,this.shortText=null,this.longText=null,this.date=null,this.done=!1}}))}ticketDate(){const t=(new Date).getFullYear();let e=(new Date).getMonth()+1,s=(new Date).getDate(),i=(new Date).getHours(),n=(new Date).getMinutes();1===String(e).length&&(e=`0${e}`),1===String(s).length&&(s=`0${s}`),1===String(n).length&&(n=`0${n}`),1===String(i).length&&(i=`0${i}`),this.date=`${s}.${e}.${String(t).slice(2)} ${i}:${n}`}updateRender(t,e,s,i){const n=document.createElement("div"),a=document.createElement("div"),o=document.createElement("div");a.classList.add("block"),a.dataset.id=i,n.classList.add("main");for(let t=0;t<5;t+=1){const t=document.createElement("div");n.appendChild(t)}!0===s&&n.children[0].classList.add("done"),n.children[0].classList.add("status"),n.children[1].textContent=t,n.children[1].classList.add("short"),n.children[1].dataset.id=i,n.children[2].textContent=e,n.children[2].classList.add("date"),n.children[3].classList.add("edit"),n.children[4].classList.add("delete"),o.classList.add("long","none"),a.appendChild(n),a.appendChild(o),this.container.appendChild(a)}async newAddTicket(t,e,s,i,n){this.clearDom();const a={name:t,description:e,created:s,status:i};n&&(a.id=n),await this.memory.save(a),this.renderTickets()}statusDone(){this.container.addEventListener("click",(t=>{if(t.target.classList.contains("status")&&t.target.classList.contains("done")){t.target.classList.remove("done");const{id:e}=t.target.closest(".block").dataset;this.memory.editStatusId(e)}else if(t.target.classList.contains("status")){t.target.classList.add("done");const{id:e}=t.target.closest(".block").dataset;this.memory.editStatusId(e)}}))}deleteTicket(){this.container.addEventListener("click",(t=>{t.target.classList.contains("delete")&&this.popupDelete.classList.contains("none")&&(this.popupDelete.classList.remove("none"),this.delOrEditMain=t.target.closest(".block"))}))}deleteTicketCancel(){this.btnDelCancel.addEventListener("click",(()=>{this.popupDelete.classList.add("none")}))}deleteTicketOk(){this.btnDelOk.addEventListener("click",(()=>{this.popupDelete.classList.add("none"),this.delOrEditMain.remove(),this.memory.deleteId(this.delOrEditMain.querySelector(".short").dataset.id),this.delOrEditMain=null}))}editTicket(){this.container.addEventListener("click",(t=>{if(t.target.classList.contains("edit")&&this.popup.classList.contains("none")){this.titlePopup.textContent="Изменить тикет",this.popup.classList.remove("none"),this.delOrEditMain=t.target.closest(".block");const{id:e}=this.delOrEditMain.dataset;this.inputShortText.value=this.delOrEditMain.children[0].children[1].textContent,this.showDescription(e,this.inputLongText)}}))}shortTextClick(){this.container.addEventListener("click",(t=>{if(t.target.classList.contains("short")&&""!==t.target.closest(".block").children[1].textContent){const e=t.target.closest(".block").children[1];e.textContent="",e.classList.add("none")}else if(t.target.classList.contains("short")){const e=t.target.closest(".block").children[1],{id:s}=t.target.dataset;this.showDescription(s,e),e.classList.remove("none")}}))}async showDescription(t,e){const s=await this.memory.loadId(t),i=e;i.value=s,i.textContent=s}inputShortTicket(){this.inputShortText.addEventListener("input",(t=>{this.shortText=t.target.value}))}inputLongTicket(){this.inputLongText.addEventListener("input",(t=>{this.longText=t.target.value}))}}(t);e.events()})();